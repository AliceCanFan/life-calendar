<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Life calendar</title>
	<link rel='stylesheet' href='bootstrap/css/bootstrap.min.css'>
	<style media="print">
		@page
		{
			size: auto;   /* auto is the current printer page size */
			margin: 0mm;  /* this affects the margin in the printer settings */
		}
	</style>
</head>
<body>


<div class="container">

	<div class="row">
		<div class="col-md-4 hidden-print">
			<div class="row-fluid">
				<div class="col-md-12 input-group">
					<span class="input-group-addon">Set your birthday:</span>
					<input type="date" class="form-control" id="b-date">
				</div>
			</div>
			<div class="row-fluid">
				<div class="col-md-12 input-group">
					<span class="input-group-addon">Select theme:</span>
					<select class="form-control" id="theme">
						<option value="0">Default</option>
						<option value="1">Light</option>
						<option value="2">Red</option>
					</select>
				</div>
			</div>
			<div class="row-fluid">
				<div class="col-md-12 btn-group">
					<a href="#" class="btn btn-default" id="saveImageBtn">Save as JPG</a>
					<a href="#" class="btn btn-default" id="savePdfBtn">Save as PDF</a>
					<a href="#" class="btn btn-default" id="printPageBtn">Print</a>
				</div>
			</div>
		</div>
		<div class="col-md-8">
			<div id="life-calendar"></div>
		</div>
	</div>

</div>

<script src="jspdf/jspdf.min.js"></script>
<script src="../src/life-calendar.js"></script>
<script>
(function(){

	var DEFAULT_CALENDAR_FILE_NAME = 'my-life-calendar',
		DEFAULT_IMAGE_TYPE = 'image/jpeg',

		date = document.getElementById('b-date'),
		theme = document.getElementById('theme'),
		block = document.getElementById('life-calendar'),
		saveImage = document.getElementById('saveImageBtn')
		savePdf = document.getElementById('savePdfBtn'),
		printPage = document.getElementById('printPageBtn'),

		themes = [
			{
				box: {
					borderColor: '#000',
					backgroundDefaultColor: '#FFF',
					backgroundPastDayColor: '#000',
				}
			},
			{
				box: {
					borderColor: '#CCC',
					backgroundDefaultColor: '#FFF',
					backgroundPastDayColor: '#87ccc9',
				}
			},
			{
				box: {
					borderColor: '#CCC',
					backgroundDefaultColor: '#FFF',
					backgroundPastDayColor: '#a52126',
				}
			}
		];

	LC.init(block);

	date.onchange = function (e) {
		var date = new Date(Date.parse(e.target.value));

		LC.update(date);

		return false;
	};

	theme.onchange = function (e) {
		var themeId = e.target.value || 0;
		var theme = themes[themeId];

		LC.changeTheme(theme);
	};

	saveImage.onclick = function (e) {
		var image = getImageFromCanvas();
		image = image.replace(DEFAULT_IMAGE_TYPE, 'image/octet-stream');

		e.target.href = image;
		e.target.download = DEFAULT_CALENDAR_FILE_NAME + '.jpg';
	};

	savePdf.onclick = function (e) {
		e.preventDefault();

		var image = getImageFromCanvas(),
			doc = new jsPDF();

		doc.addImage(image, 'JPEG', 20, 5, 170, 280);
		doc.save(DEFAULT_CALENDAR_FILE_NAME + '.pdf');
	};

	printPage.onclick = function (e) {
		e.preventDefault();

		window.print();
	};

	function getImageFromCanvas() {
		return block.querySelector('canvas').toDataURL(DEFAULT_IMAGE_TYPE);
	}

}());
</script>
</body>
</html>